<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voxa Admin Panel</title>
  <style>
    :root{
      --bg:#0b1220; --text:#eaf0ff; --muted:#a9b7d7;
      --brand:#4aa3ff; --ok:#29d17d; --warn:#ffcc66; --danger:#ff5c7a;
      --border:rgba(255,255,255,.08); --shadow:0 18px 50px rgba(0,0,0,.45); --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(74,163,255,.25), transparent 60%),
        radial-gradient(900px 500px at 20% 0%, rgba(41,209,125,.16), transparent 55%),
        var(--bg);
      color:var(--text); min-height:100vh;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:22px 16px 40px}
    .header{
      display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;
      padding:14px;border:1px solid var(--border);border-radius:var(--radius);
      background: rgba(255,255,255,.04); box-shadow:var(--shadow);
    }
    .title{display:flex;gap:12px;align-items:center}
    .badge{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(74,163,255,.9), rgba(41,209,125,.7));
      display:grid;place-items:center;font-weight:900;
    }
    .title h1{margin:0;font-size:18px}
    .title p{margin:4px 0 0;color:var(--muted);font-size:12px;line-height:1.6}
    .btn{
      cursor:pointer;border:1px solid var(--border);background: rgba(255,255,255,.04);
      color:var(--text);padding:10px 12px;border-radius:14px;font-weight:900;
      text-decoration:none; display:inline-flex; align-items:center; justify-content:center;
    }
    .btn.primary{border-color: rgba(74,163,255,.45);background: rgba(74,163,255,.16)}
    .btn.ok{border-color: rgba(41,209,125,.45);background: rgba(41,209,125,.14)}
    .btn.danger{border-color: rgba(255,92,122,.45);background: rgba(255,92,122,.14)}
    .btn.small{padding:8px 10px;border-radius:12px;font-weight:800}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .pill{
      display:inline-flex;gap:10px;align-items:center;
      padding:8px 10px;border-radius:999px;border:1px solid var(--border);
      background: rgba(255,255,255,.03);color:var(--muted);font-size:12px;
    }
    .grid{display:grid;grid-template-columns: repeat(12,1fr);gap:14px;margin-top:14px}
    .card{
      grid-column:span 12;padding:16px;border-radius:var(--radius);border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
    }
    .card h2{margin:0 0 10px;font-size:16px}
    .muted{color:var(--muted);font-size:12px;line-height:1.7}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{
      border:1px solid var(--border); background: rgba(255,255,255,.03); color:var(--text);
      padding:8px 10px;border-radius:999px;font-weight:900;cursor:pointer;font-size:12px;
    }
    .tab.active{border-color: rgba(74,163,255,.45);background: rgba(74,163,255,.16)}
    input, textarea, select{
      width:100%; border-radius: 14px; border:1px solid var(--border);
      background: rgba(0,0,0,.18); padding:10px 12px; color:var(--text);
      outline:none; font-size:14px;
    }
    textarea{min-height:110px;resize:vertical}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    .fgrid{display:grid;grid-template-columns: 1fr 1fr;gap:12px}
    @media (max-width:900px){ .fgrid{grid-template-columns:1fr} }

    .list{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .item{
      border:1px solid var(--border);background: rgba(255,255,255,.03);
      border-radius:16px;padding:12px;
    }
    .itemTop{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .itemTitle{font-weight:900}
    .hr{height:1px;background: var(--border);margin:12px 0}

    .actions{
      display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;
    }
    @media (max-width:520px){
      .actions .btn{flex:1 1 auto; justify-content:center}
    }

    .status{
      font-weight:900;
      padding:6px 10px;border-radius:999px;border:1px solid var(--border);
      background: rgba(255,255,255,.03);font-size:12px;
    }
    .s-open{color:var(--warn)}
    .s-done{color:var(--ok)}
    .s-closed{color:var(--danger)}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <div class="badge">VX</div>
        <div>
          <h1>Voxa Admin Panel</h1>
          <p>Login بالباسورد → Sellers / Orders / Proofs / Issues / Supplies</p>
        </div>
      </div>
      <div class="row">
        <a class="btn primary" href="index.html">رجوع للموقع</a>
        <span class="pill" id="loginPill">غير مسجل</span>
        <button class="btn danger hidden" id="logoutBtn">خروج</button>
      </div>
    </div>

    <div class="grid">
      <!-- Login -->
      <div class="card" id="loginCard">
        <h2>تسجيل دخول الأدمن</h2>
        <div class="muted">البانل مش هتظهر لحد معاه الباسورد.</div>
        <div class="hr"></div>
        <div class="fgrid">
          <div>
            <label>الباسورد</label>
            <input id="passInput" type="password" placeholder="اكتب الباسورد" />
          </div>
          <div>
            <label>زر الدخول</label>
            <button class="btn ok" id="loginBtn">دخول</button>
          </div>
        </div>
        <div class="muted" id="loginNote" style="margin-top:10px"></div>
      </div>

      <!-- Admin -->
      <div class="card hidden" id="adminCard">
        <div class="row">
          <div>
            <h2 style="margin:0">Dashboard</h2>
            <div class="muted" id="countsPill">…</div>
          </div>
          <span class="pill">Static (localStorage)</span>
        </div>

        <div class="hr"></div>

        <div class="tabs">
          <button class="tab active" data-tab="sellers">Sellers</button>
          <button class="tab" data-tab="orders">Orders</button>
          <button class="tab" data-tab="proofs">Proofs</button>
          <button class="tab" data-tab="issues">Issues</button>
          <button class="tab" data-tab="supplies">Supplies</button>
        </div>

        <!-- SELLERS -->
        <div id="tab-sellers" style="margin-top:12px">
          <div class="muted">إضافة/حذف بائعين (ينعكس على صفحة Sellers في الموقع).</div>
          <div class="hr"></div>

          <div class="fgrid">
            <div>
              <label>يوزر البائع</label>
              <input id="sellerInput" placeholder="مثال: gq_8" />
            </div>
            <div>
              <label>زر الإضافة</label>
              <button class="btn primary" id="addSellerBtn">+ إضافة بائع</button>
            </div>
          </div>

          <div class="list" id="sellersList"></div>
        </div>

        <!-- ORDERS -->
        <div id="tab-orders" class="hidden" style="margin-top:12px">
          <div class="muted">الطلبات هنا. أولًا تعمل استلام → بعدين Done عشان يروح Proofs.</div>
          <div class="hr"></div>
          <div class="list" id="ordersList"></div>
        </div>

        <!-- PROOFS -->
        <div id="tab-proofs" class="hidden" style="margin-top:12px">
          <div class="muted">الطلبات اللي اتعملها Done بتظهر هنا كـ Proofs (بدون أزرار).</div>
          <div class="hr"></div>
          <div class="list" id="proofsList"></div>
        </div>

        <!-- ISSUES -->
        <div id="tab-issues" class="hidden" style="margin-top:12px">
          <div class="muted">الشكاوي اللي جاية من Support. لكل مشكلة زر “رد”.</div>
          <div class="hr"></div>
          <div class="list" id="issuesList"></div>
        </div>

        <!-- SUPPLIES -->
        <div id="tab-supplies" class="hidden" style="margin-top:12px">
          <div class="muted">هنا تضيف المنتجات اللي تتباع وتظهر في Shop.</div>
          <div class="hr"></div>

          <div class="fgrid">
            <div>
              <label>القسم</label>
              <select id="supCategory">
                <option value="nitros">nitros</option>
                <option value="credits">credits</option>
                <option value="visas">visas</option>
                <option value="effects">effects</option>
                <option value="boosts">boosts</option>
                <option value="accounts">accounts</option>
              </select>
            </div>
            <div>
              <label>اسم المنتج</label>
              <input id="supTitle" placeholder="Nitro 1 Month" />
            </div>
          </div>

          <div class="fgrid" style="margin-top:12px">
            <div>
              <label>السعر (EGP)</label>
              <input id="supPrice" type="number" min="1" placeholder="250" />
            </div>
            <div>
              <label>البائع (يوزر)</label>
              <input id="supSeller" placeholder="gq_8" />
            </div>
          </div>

          <div style="margin-top:12px">
            <label>وصف</label>
            <textarea id="supDesc" placeholder="وصف سريع…"></textarea>
          </div>

          <div style="margin-top:12px">
            <button class="btn primary" id="addSupplyBtn">+ إضافة منتج</button>
          </div>

          <div class="list" id="suppliesList"></div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ✅ الباسورد
    const PANEL_PASSWORD = "VOXA-PANEL-KEY";

    // Storage keys shared with the site
    const KEY_AUTH    = "voxa_panel_auth";
    const KEY_SELLERS = "voxa_sellers";
    const KEY_ORDERS  = "voxa_orders";
    const KEY_PROOFS  = "voxa_proofs";
    const KEY_ISSUES  = "voxa_issues";
    const KEY_SUPPLY  = "voxa_supplies";

    const DEFAULT_SELLERS = ["gq_8", "k_i_l_"];
    const CATEGORIES = ["nitros","credits","visas","effects","boosts","accounts"];

    // Helpers
    const uid = (p)=> p + "_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
    const loadJSON = (k, f)=> { try{ return JSON.parse(localStorage.getItem(k) || JSON.stringify(f)); }catch{return f;} };
    const saveJSON = (k, v)=> localStorage.setItem(k, JSON.stringify(v));
    const isAuthed = ()=> localStorage.getItem(KEY_AUTH) === "true";
    const setAuth = (v)=> localStorage.setItem(KEY_AUTH, v ? "true" : "false");
    const esc = (s)=> String(s||"")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");

    function statusHTML(s){
      if (s==="open") return `<span class="status s-open">open</span>`;
      if (s==="done") return `<span class="status s-done">done</span>`;
      return `<span class="status s-closed">closed</span>`;
    }

    // Ensure defaults exist
    if (!localStorage.getItem(KEY_SELLERS)) saveJSON(KEY_SELLERS, DEFAULT_SELLERS);
    if (!localStorage.getItem(KEY_ORDERS))  saveJSON(KEY_ORDERS, []);
    if (!localStorage.getItem(KEY_PROOFS))  saveJSON(KEY_PROOFS, []);
    if (!localStorage.getItem(KEY_ISSUES))  saveJSON(KEY_ISSUES, []);
    if (!localStorage.getItem(KEY_SUPPLY))  saveJSON(KEY_SUPPLY, []);

    // Elements
    const loginPill = document.getElementById("loginPill");
    const loginCard = document.getElementById("loginCard");
    const adminCard = document.getElementById("adminCard");
    const logoutBtn = document.getElementById("logoutBtn");

    const passInput = document.getElementById("passInput");
    const loginBtn  = document.getElementById("loginBtn");
    const loginNote = document.getElementById("loginNote");
    const countsPill= document.getElementById("countsPill");

    // Tabs
    const tabBtns = Array.from(document.querySelectorAll(".tab"));
    const tabs = {
      sellers: document.getElementById("tab-sellers"),
      orders: document.getElementById("tab-orders"),
      proofs: document.getElementById("tab-proofs"),
      issues: document.getElementById("tab-issues"),
      supplies: document.getElementById("tab-supplies")
    };

    function showTab(name){
      tabBtns.forEach(b=> b.classList.toggle("active", b.dataset.tab===name));
      Object.entries(tabs).forEach(([k,el])=> el.classList.toggle("hidden", k!==name));
    }
    tabBtns.forEach(b=> b.addEventListener("click", ()=> showTab(b.dataset.tab)));

    // Auth UI
    function applyAuthUI(){
      const ok = isAuthed();
      loginPill.textContent = ok ? "مسجل ✅" : "غير مسجل";
      loginCard.classList.toggle("hidden", ok);
      adminCard.classList.toggle("hidden", !ok);
      logoutBtn.classList.toggle("hidden", !ok);
      if (ok) renderAll();
    }

    logoutBtn.addEventListener("click", ()=>{ setAuth(false); applyAuthUI(); });

    loginBtn.addEventListener("click", ()=>{
      const p = (passInput.value||"").trim();
      if (p !== PANEL_PASSWORD){
        loginNote.textContent = "❌ باسورد غلط.";
        return;
      }
      setAuth(true);
      passInput.value = "";
      loginNote.textContent = "";
      applyAuthUI();
    });

    // Counts
    function renderCounts(){
      const sellers = loadJSON(KEY_SELLERS, DEFAULT_SELLERS).length;
      const orders  = loadJSON(KEY_ORDERS, []).length;
      const proofs  = loadJSON(KEY_PROOFS, []).length;
      const issues  = loadJSON(KEY_ISSUES, []).length;
      const supplies= loadJSON(KEY_SUPPLY, []).length;
      countsPill.textContent = `Sellers: ${sellers} — Orders: ${orders} — Proofs: ${proofs} — Issues: ${issues} — Supplies: ${supplies}`;
    }

    // ===== SELLERS =====
    const sellerInput = document.getElementById("sellerInput");
    const addSellerBtn = document.getElementById("addSellerBtn");
    const sellersList = document.getElementById("sellersList");

    function renderSellers(){
      const list = loadJSON(KEY_SELLERS, DEFAULT_SELLERS);
      sellersList.innerHTML = list.length ? list.map(u=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">@${esc(u)}</div>
            <span class="status s-done">seller</span>
          </div>
          <div class="actions">
            <button class="btn danger small" data-del-seller="${esc(u)}">حذف</button>
          </div>
        </div>
      `).join("") : `<div class="muted">لا يوجد بائعين.</div>`;

      sellersList.querySelectorAll("[data-del-seller]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const user = btn.getAttribute("data-del-seller");
          let arr = loadJSON(KEY_SELLERS, DEFAULT_SELLERS);
          arr = arr.filter(x=>x !== user);
          saveJSON(KEY_SELLERS, arr);
          renderAll();
        });
      });
    }

    addSellerBtn.addEventListener("click", ()=>{
      const u = (sellerInput.value||"").trim();
      if (!u) return;
      let arr = loadJSON(KEY_SELLERS, DEFAULT_SELLERS);
      if (!arr.includes(u)) arr.unshift(u);
      saveJSON(KEY_SELLERS, arr);
      sellerInput.value = "";
      renderAll();
    });

    // ===== ORDERS (Claim -> Done -> Move to Proofs) =====
    const ordersList = document.getElementById("ordersList");

    function normalizeDiscordLink(contact){
      const c = String(contact||"").trim();
      if (!c) return null;

      // رابط مباشر
      if (/^https?:\/\//i.test(c)) return c;

      // Discord user id
      if (/^\d{10,20}$/.test(c)) return `https://discord.com/users/${c}`;

      return null;
    }

    async function copyText(txt){
      try{
        await navigator.clipboard.writeText(txt);
        alert("✅ تم نسخ وسيلة التواصل");
      }catch{
        prompt("انسخ يدويًا:", txt);
      }
    }

    function renderOrders(){
      const list = loadJSON(KEY_ORDERS, []);

      ordersList.innerHTML = list.length ? list.map(o=>{
        const claimState = o.claimState || (o.claimedBy ? "claimed" : "unclaimed");
        const isClaimed = claimState === "claimed";
        const status = o.status || "open";

        const contactLink = normalizeDiscordLink(o.contact);
        const claimedLine = isClaimed
          ? `مستلم بواسطة: <b style="color:var(--text)">${esc(o.claimedBy||"—")}</b> — وقت: ${o.claimedAt ? new Date(o.claimedAt).toLocaleString() : "—"}`
          : `غير مستلم`;

        const commBtn = contactLink
          ? `<a class="btn small" href="${contactLink}" target="_blank" rel="noopener">فتح تواصل</a>`
          : `<button class="btn small" data-copy-contact="${esc(o.contact)}">نسخ التواصل</button>`;

        return `
          <div class="item">
            <div class="itemTop">
              <div class="itemTitle">${esc(o.details)}</div>
              ${statusHTML(status)}
            </div>

            <div class="muted" style="margin-top:6px">
              العميل: <b style="color:var(--text)">${esc(o.customer)}</b> —
              تواصل: <b style="color:var(--text)">${esc(o.contact)}</b><br/>
              ${claimedLine}<br/>
              وقت الإنشاء: ${new Date(o.at).toLocaleString()}
            </div>

            <div class="actions">
              ${!isClaimed ? `<button class="btn ok small" data-o-claim="${o.id}">استلام</button>` : ``}
              ${isClaimed ? `<button class="btn ok small" data-o-done="${o.id}">done</button>` : ``}

              <button class="btn danger small" data-o-set="closed" data-oid="${o.id}">closed</button>
              <button class="btn small" data-o-del="${o.id}">حذف</button>
              ${commBtn}
            </div>
          </div>
        `;
      }).join("") : `<div class="muted">لا يوجد Orders.</div>`;

      // Claim
      ordersList.querySelectorAll("[data-o-claim]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-o-claim");
          const adminName = prompt("اكتب اسم/يوزر الأدمن اللي استلم الطلب:");
          if(!adminName) return;

          const arr = loadJSON(KEY_ORDERS, []);
          const it = arr.find(x=>x.id===id);
          if(!it) return;

          it.claimState = "claimed";
          it.claimedBy = adminName.trim();
          it.claimedAt = new Date().toISOString();

          saveJSON(KEY_ORDERS, arr);

          // افتح رابط التواصل لو ينفع
          const link = normalizeDiscordLink(it.contact);
          if(link) window.open(link, "_blank", "noopener");

          renderAll();
        });
      });

      // Done -> move to proofs
      ordersList.querySelectorAll("[data-o-done]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-o-done");
          const orders = loadJSON(KEY_ORDERS, []);
          const it = orders.find(x=>x.id===id);
          if(!it) return;

          const claimState = it.claimState || (it.claimedBy ? "claimed" : "unclaimed");
          if(claimState !== "claimed"){
            alert("❌ لازم تعمل استلام الأول.");
            return;
          }

          const newOrders = orders.filter(x=>x.id!==id);
          saveJSON(KEY_ORDERS, newOrders);

          const proofs = loadJSON(KEY_PROOFS, []);
          proofs.unshift({
            ...it,
            status: "done",
            doneAt: new Date().toISOString()
          });
          saveJSON(KEY_PROOFS, proofs);

          renderAll();
        });
      });

      // Closed status
      ordersList.querySelectorAll("[data-o-set]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-oid");
          const st = btn.getAttribute("data-o-set");
          const arr = loadJSON(KEY_ORDERS, []);
          const it = arr.find(x=>x.id===id);
          if (it){ it.status = st; saveJSON(KEY_ORDERS, arr); renderAll(); }
        });
      });

      // Delete
      ordersList.querySelectorAll("[data-o-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-o-del");
          const arr = loadJSON(KEY_ORDERS, []).filter(x=>x.id!==id);
          saveJSON(KEY_ORDERS, arr);
          renderAll();
        });
      });

      // Copy contact
      ordersList.querySelectorAll("[data-copy-contact]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const txt = btn.getAttribute("data-copy-contact") || "";
          copyText(txt);
        });
      });
    }

    // ===== PROOFS =====
    const proofsList = document.getElementById("proofsList");
    function renderProofs(){
      const list = loadJSON(KEY_PROOFS, []);
      proofsList.innerHTML = list.length ? list.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.details)}</div>
            <span class="status s-done">proof</span>
          </div>
          <div class="muted" style="margin-top:6px">
            العميل: <b style="color:var(--text)">${esc(p.customer)}</b> —
            تواصل: <b style="color:var(--text)">${esc(p.contact)}</b><br/>
            مستلم بواسطة: <b style="color:var(--text)">${esc(p.claimedBy||"—")}</b><br/>
            وقت Done: ${p.doneAt ? new Date(p.doneAt).toLocaleString() : "—"}
          </div>
        </div>
      `).join("") : `<div class="muted">لا يوجد Proofs.</div>`;
    }

    // ===== ISSUES =====
    const issuesList = document.getElementById("issuesList");

    function renderIssues(){
      const list = loadJSON(KEY_ISSUES, []);
      issuesList.innerHTML = list.length ? list.map(i=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">Issue: ${esc(i.type)}</div>
            ${statusHTML(i.status)}
          </div>
          <div class="muted" style="margin-top:6px">
            من: <b style="color:var(--text)">${esc(i.name)}</b> —
            تواصل: <b style="color:var(--text)">${esc(i.contact)}</b><br/>
            وقت: ${new Date(i.at).toLocaleString()}<br/>
            التفاصيل: ${esc(i.details)}
          </div>

          ${(Array.isArray(i.replies) && i.replies.length) ? `
            <div class="muted" style="margin-top:10px">
              <b style="color:var(--text)">آخر رد:</b> ${esc(i.replies[0].msg)}<br/>
              <span style="opacity:.85">${new Date(i.replies[0].at).toLocaleString()}</span>
            </div>
          ` : ""}

          <div class="actions">
            <button class="btn primary small" data-reply="${i.id}">رد</button>
            <button class="btn ok small" data-i-set="done" data-iid="${i.id}">done</button>
            <button class="btn danger small" data-i-set="closed" data-iid="${i.id}">closed</button>
            <button class="btn small" data-i-del="${i.id}">حذف</button>
          </div>
        </div>
      `).join("") : `<div class="muted">لا يوجد Issues.</div>`;

      issuesList.querySelectorAll("[data-i-set]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-iid");
          const st = btn.getAttribute("data-i-set");
          const arr = loadJSON(KEY_ISSUES, []);
          const it = arr.find(x=>x.id===id);
          if (it){ it.status = st; saveJSON(KEY_ISSUES, arr); renderAll(); }
        });
      });

      issuesList.querySelectorAll("[data-i-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-i-del");
          const arr = loadJSON(KEY_ISSUES, []).filter(x=>x.id!==id);
          saveJSON(KEY_ISSUES, arr);
          renderAll();
        });
      });

      issuesList.querySelectorAll("[data-reply]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-reply");
          const msg = prompt("اكتب الرد على الشكوى:");
          if (!msg) return;

          const arr = loadJSON(KEY_ISSUES, []);
          const it = arr.find(x=>x.id===id);
          if (!it) return;

          if (!Array.isArray(it.replies)) it.replies = [];
          it.replies.unshift({ at: new Date().toISOString(), msg: msg.trim() });
          it.status = "done";
          saveJSON(KEY_ISSUES, arr);

          alert("✅ تم حفظ الرد.");
          renderAll();
        });
      });
    }

    // ===== SUPPLIES =====
    const supCategory = document.getElementById("supCategory");
    const supTitle = document.getElementById("supTitle");
    const supPrice = document.getElementById("supPrice");
    const supSeller = document.getElementById("supSeller");
    const supDesc = document.getElementById("supDesc");
    const addSupplyBtn = document.getElementById("addSupplyBtn");
    const suppliesList = document.getElementById("suppliesList");

    function renderSupplies(){
      const list = loadJSON(KEY_SUPPLY, []);
      suppliesList.innerHTML = list.length ? list.map(p=>`
        <div class="item">
          <div class="itemTop">
            <div class="itemTitle">${esc(p.title)} <span class="muted">(${esc(p.category)})</span></div>
            <span class="status s-done">${Number(p.price)||0} EGP</span>
          </div>
          <div class="muted" style="margin-top:6px">
            Seller: <b style="color:var(--text)">@${esc(p.seller || "—")}</b><br/>
            ${esc(p.desc)}
          </div>
          <div class="actions">
            <button class="btn small" data-s-del="${p.id}">حذف</button>
          </div>
        </div>
      `).join("") : `<div class="muted">لا يوجد Products.</div>`;

      suppliesList.querySelectorAll("[data-s-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-s-del");
          const arr = loadJSON(KEY_SUPPLY, []).filter(x=>x.id!==id);
          saveJSON(KEY_SUPPLY, arr);
          renderAll();
        });
      });
    }

    addSupplyBtn.addEventListener("click", ()=>{
      const cat = supCategory.value;
      const title = (supTitle.value||"").trim();
      const price = Number(supPrice.value||0);
      const seller = (supSeller.value||"").trim().replace(/^@/,"");
      const desc = (supDesc.value||"").trim();

      if (!CATEGORIES.includes(cat) || !title || !price || !desc) return;

      const arr = loadJSON(KEY_SUPPLY, []);
      arr.unshift({ id: uid("p"), at: new Date().toISOString(), category: cat, title, price, seller, desc });
      saveJSON(KEY_SUPPLY, arr);

      supTitle.value=""; supPrice.value=""; supSeller.value=""; supDesc.value="";
      renderAll();
    });

    // Render all
    function renderAll(){
      renderCounts();
      renderSellers();
      renderOrders();
      renderProofs();
      renderIssues();
      renderSupplies();
    }

    // Init
    applyAuthUI();
    if (isAuthed()) renderAll();
    window.addEventListener("storage", ()=>{ if (isAuthed()) renderAll(); });

    // default tab
    showTab("sellers");
  </script>
</body>
</html>
